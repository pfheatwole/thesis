%%%% file pwasu.sty
%% From Chapter 21 of the memoir manual: "An Example Thesis Design"
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{pwasu}[2009/04/18 v0.3 ASU thesis]

%% NOTE: Only works with the memoir class
\@ifclassloaded{memoir}{\let\endpwasu\relax}{\let\endpwasu\endinput
  \PackageError{pwasu}{The pwasu package only works with the memoir class}%
               {\@ehd}}
\endpwasu

% Grab the title and author, as defined from Sphinx
\def\doctitle{\@title}
\def\docauthor{\@author}


%%%% Font

\setverbatimfont{\normalfont\rmfamily} % Make verbatims the body font
\renewcommand*{\foottextfont}{\normalfont\normalsize}


%%%% Margins and spacing

% Enable spacing to be changed if necessary by the user
\newcommand*{\setasuspacing}[1]{%
    \let\AsuSpacing#1
    \AsuSpacing}
\setasuspacing{\DoubleSpacing}

% Set margins and textwidth
\setlrmarginsandblock{1.5in}{1in}{*}

%% For main body, bottom of text at 1in, footer below
%% top of header at 1in, first text line double spaced
%% below base of header
\newlength{\linespace}
\setlength{\linespace}{\baselineskip} % current equivalent of \onelineskip
\setlength{\headheight}{\onelineskip}
\setlength{\headsep}{\linespace}
\addtolength{\headsep}{-\topskip}
\setlength{\uppermargin}{1in}
\addtolength{\uppermargin}{\headheight}
\addtolength{\uppermargin}{\headsep}

%% Bottom
\setlength{\lowermargin}{1in}
\setlength{\textheight}{\paperheight}
\addtolength{\textheight}{-\uppermargin}
\addtolength{\textheight}{-\lowermargin}

%% Footnote
\setlength{\footskip}{\onelineskip} 
\setlength{\footnotesep}{\onelineskip}

%% Fiddle lengths (..ta.. for title/approval page, others for prelims)
\newlength{\toptafiddle} \setlength{\toptafiddle}{2\linespace}
\newlength{\bottafiddle} \setlength{\bottafiddle}{0pt}
\newlength{\topfiddle} \setlength{\topfiddle}{\toptafiddle}
\newlength{\botfiddle} \setlength{\botfiddle}{\onelineskip}

\setlength{\parindent}{2em}
\checkandfixthelayout[nearest]

% Apply corrections for non-body (frontmatter) margins
\newcommand*{\addtotextheight}[1]{%
    \twocolumn
    \addtolength{\textheight}{#1}%
    \onecolumn}


%%%% Pagestyles

%% the main text
\makepagestyle{asu}
    \makeevenhead{asu}{\thepage}{}{}
    \makeoddhead{asu}{}{}{\thepage}

%% for continuation pages of the ToC, LoF, LoT
\makepagestyle{toc}
    \makeevenfoot{toc}{}{\thepage}{}
    \makeoddfoot{toc}{}{\thepage}{}
    \makeevenhead{toc}{Chapter}{}{Page}
    \makeoddhead{toc}{Chapter}{}{Page}
\makepagestyle{lof}
    \makeevenfoot{lof}{}{\thepage}{}
    \makeoddfoot{lof}{}{\thepage}{}
    \makeevenhead{lof}{Figure}{}{Page}
    \makeoddhead{lof}{Figure}{}{Page}
\makepagestyle{lot}
    \makeevenfoot{lot}{}{\thepage}{}
    \makeoddfoot{lot}{}{\thepage}{}
    \makeevenhead{lot}{Table}{}{Page}
    \makeoddhead{lot}{Table}{}{Page}

%% List of Figures
\AtBeginDocument{%
    \renewcommand{\listfigurename}{LIST OF FIGURES}
}
\addtodef{\listoffigures}{\clearpage\pagestyle{lof}}{}
\renewcommand*{\lofheadstart}{\vspace*{-\topfiddle}}
\renewcommand*{\afterloftitle}{\thispagestyle{plain}%
    \par\nobreak {\normalfont Figure \hfill Page}\par\nobreak}

%% List of Tables
\AtBeginDocument{%
    \renewcommand{\listtablename}{LIST OF TABLES}
}
\addtodef{\listoftables}{\clearpage\pagestyle{lot}}{}
\renewcommand*{\lotheadstart}{\vspace*{-\topfiddle}}
\renewcommand*{\afterlottitle}{\thispagestyle{plain}%
    \par\nobreak {\normalfont Table \hfill Page}\par\nobreak}

%% Table of Contents
\AtBeginDocument{%
    \renewcommand{\contentsname}{TABLE OF CONTENTS}
}
\addtodef{\tableofcontents}{\clearpage\pagestyle{toc}}{}
\renewcommand*{\tocheadstart}{\vspace*{-\topfiddle}}
\renewcommand*{\aftertoctitle}{\thispagestyle{plain}%
    \par\nobreak \mbox{}\hfill{\normalfont Page}\par\nobreak}
\renewcommand*{\cftchapterfont}{\normalfont}
\renewcommand*{\cftchapterpagefont}{\normalfont}
\renewcommand*{\cftchapterleader}{%
    \cftchapterfont\cftdotfill{\cftchapterdotsep}}
\renewcommand*{\cftchapterdotsep}{\cftdotsep}
\setsecnumdepth{subsection}

%% No extra space before the entry, or in the LoF/LoT
\setlength{\cftbeforechapterskip}{0pt plus 0pt}
\renewcommand*{\insertchapterspace}{}

%% Chapter
\makechapterstyle{asu}{%
    \setlength{\beforechapskip}{-\topfiddle}
    \setlength{\midchapskip}{1.0\onelineskip}
    \setlength{\afterchapskip}{1.0\onelineskip}
    \renewcommand*{\chapnamefont}{\normalfont}
    \renewcommand*{\chapnumfont}{\chapnamefont}
    \renewcommand*{\printchapternum}{\centering\chapnumfont \thechapter}
    \renewcommand*{\chaptitlefont}{\normalfont\centering}
    \renewcommand*{\printchapternonum}{}}
\aliaspagestyle{chapter}{empty}

%% chapter style for appendices, text comes on following page

\makechapterstyle{asuappendix}{%
    \setlength{\beforechapskip}{-\topfiddle}
    \setlength{\midchapskip}{1.0\onelineskip}
    \setlength{\afterchapskip}{1.0\onelineskip}
    \renewcommand*{\chapnamefont}{\normalfont}
    \renewcommand*{\chapnumfont}{\chapnamefont}
    \renewcommand*{\printchaptername}{%
        \chapnamefont\MakeUppercase{\@chapapp}}
    \renewcommand*{\printchapternum}{\centering\chapnumfont \thechapter}
    \renewcommand*{\chaptitlefont}{\normalfont\centering}
    %\renewcommand*{\printchapternonum}{}
    %\renewcommand*{\afterchaptertitle}{\clearpage}
    }

%%% different chapter style for appendices, (and double spaced)
\addtodef{\appendix}{}{\chapterstyle{asuappendix}\AsuSpacing}

%%% (subsub)section styles
\setsecheadstyle{\centering\normalfont}
\setbeforesecskip{-1\onelineskip plus -1ex minus -.2ex}
\setaftersecskip{1\onelineskip plus .2ex}
\setsubsecheadstyle{\centering\normalfont}
\setbeforesubsecskip{-1\onelineskip plus -1ex minus -.2ex}
\setaftersubsecskip{1\onelineskip plus .2ex}


%% Bibliography
\AtBeginDocument{
    \renewcommand*{\bibname}{REFERENCES}
}
\setlength{\bibitemsep}{\onelineskip}
\renewcommand*{\biblistextra}{%
    \setlength{\itemsep}{\bibitemsep}
    \setlength{\labelwidth}{0pt}
    \setlength{\leftmargin}{3em}% hanging indent
    \setlength{\itemindent}{-\leftmargin}}
\renewcommand*{\bibsection}{%
    \AsuSpacing
    \addcontentsline{toc}{chapter}{\bibname}
    \chapter*{\bibname}
    \SingleSpacing}

%% endnotes
\renewcommand*{\notesname}{NOTES}
\renewcommand*{\notedivision}{%
    \AsuSpacing
    \chapter*{\notesname}
    \addcontentsline{toc}{chapter}{\notesname}
    \SingleSpacing}
\continuousnotenums
\renewcommand*{\notenuminnotes}[1]{\textsuperscript{#1}\space}
\renewcommand{\noteinnotes}[1]{#1\\}
\renewcommand*{\pagenotesubhead}[3]{}% no subheads

%%% general macro for Abstract, etc., headings
\newcommand*{\pretoctitle}[1]{{\clearpage\centering
\vspace*{-\topfiddle}#1\par}}

%%% Start the ACKNOWLEDGEMENTS
\newcommand{\asuacknowledgements}{\pretoctitle{ACKNOWLEDGEMENTS}}

%%% Start the ABSTRACT
\newcommand{\asuabstract}{%
    \addtotextheight{-\botfiddle}%
    \pretoctitle{ABSTRACT}
    \begin{center}
        \doctitle \\
        \docauthor
    \end{center}
    }

% Make sure to reset text height when the mainmatter starts
\addtodef{\mainmatter}{\addtotextheight{\botfiddle}}{}

%% make it easy to center any dedication
\newcommand{\asudedication}[1]{%
    {\clearpage\mbox{}\vfill\centering #1 \par\vfill\clearpage}}

%% for any headings after the tocloft and before the main body
\newcommand{\prelimtitle}[1]{%
    \pretoctitle{#1}\addcontentsline{toc}{chapter}{#1}}


%% Build the title page
\newcommand{\thetitlepage}{{
    \clearpage
    \thispagestyle{empty}
    \centering
    \vspace*{-\toptafiddle}
    \MakeUppercase{\doctitle}  % FIXME: just use \title?
    \vfill
    {\SingleSpace
        A Thesis \\
        presented to \\
        the Faculty of California Polytechnic State University,\\
        San Luis Obispo\par
    }
    \vfill
    {\SingleSpace
        In Partial Fulfillment \\
        of the Requirements for the Degree \\
        Master of Science in Electrical Engineering\par
    }
    \vfill
    by \\
    Peter Heatwole \\
    August 2017
    \par
    \enlargethispage{-2in}
    \clearpage
    }}


%% Build the copyright page
\newcommand{\copyrightpage}{{
    %\thispagestyle{empty}
    \centering
    \vspace*{\fill}
    \textcopyright\, 2017 \\
    Peter Heatwole \\
    ALL RIGHTS RESERVED
    \par
    \enlargethispage{-1in}
    \clearpage
    }}


\newcommand{\committeepage}{{
    \begin{SingleSpace}
    \begin{center}
        COMMITTEE MEMBERSHIP
    \end{center}
    \par
    \vspace*{0.5in}
    %\begin{tabular}{rp{3.01in}}
    \begin{tabular}{rl}
        TITLE:  &\doctitle \\\\\\
        AUTHOR: &\docauthor \\\\\\
        %DATE SUBMITTED: &\@degreemonth~\@degreeyear  \par\\
        DATE SUBMITTED: &<FIXME: month and year> \\\\\\
        \\\\\\
        COMMITTEE CHAIR:
            &Lynne Slivovsky, Ph.D. \\
            &Professor of Electrical Engineering \\\\\\
        COMMITTEE MEMBER:
            &Marty Kaliski, Ph.D. \\
            &Professor of Electrical Engineering \\\\\\
        COMMITTEE MEMBER:
            &Somebody Else, M.Sc. \\
            &Professor of Electrical Engineering \\\\\\
    \end{tabular}
    \end{SingleSpace}
    \clearpage
    }}

%%% put your biographical text in this environment
%% \begin{biosketch} Iâ€™m a person who has accomplished .... \end{biosketch}
\newenvironment{biosketch}{%
    \pretoctitle{BIOGRAPHICAL SKETCH}\thispagestyle{empty}\SingleSpacing}%
    {}

%% use the asu chapterstyle and plain pagestyle
\chapterstyle{asu}
\pagestyle{plain}


% end of .sty file
\endinput
